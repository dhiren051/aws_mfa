# aws_mfa
Working Example of Modern Software Delivery and also getting an MFA token from AWS 
My man [drvdana] dropped this on the world. I just cleaned it up a bit by making it [PEP8] compliant. 

Enabling MFA in the Terminal has 2 flavors:
 * AWS [Supported] Approach
 * This approach

Setup to add the session token to your aws profile

1. Backup your AWS configs
2. Edit `~/.aws/config`, duplicate the existing profile and update the original to include '-default'; E.G.:
```bash
[profile bob-default]
output = json
region = us-west-2

[profile bob]
output = json
region = us-west-2
```

3. Edit `~/.aws/credentials`, duplicate existing profile and update the copy to include '-default'; E.G.:
```bash
[bob-default]
aws_access_key_id = ABCD
aws_secret_access_key = 1234
```

For the original entry, add the `aws_arn_mfa =` line; _the ARN is located: IAM > Users > bob > Security Credentials > Assigned MFA device_. Remove the other values.
```bash
[bob]
aws_arn_mfa = <arn-from-iam-console>
aws_access_key_id = <auto-generated>
aws_secret_access_key = <auto-generated>
aws_session_token = <auto-generated>
```

## Execute the Script

`curl -fsSL https://goo.gl/fooBar --profile "bob" --arn arn:aws:iam::ABCDEF123456:mfa/bob --credential-path ~/.aws/credentials <virtual-mfa-token>`


Output from command:

`Saved pimco credentials to /Users/bob/.aws/credentials`


9.	Test the following command again: 

`aws iam get-user --user-name bob`

_NOTE: this token will expire every 12 hours._



[drvdana]: https://github.com/drvdana
[Supported]: https://aws.amazon.com/premiumsupport/knowledge-center/authenticate-mfa-cli/
[PEP8]: https://www.python.org/dev/peps/pep-0008/
